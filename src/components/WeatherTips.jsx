import { useState, useEffect } from 'react';
import axios from 'axios';
import '../styles/WeatherTips.css';

function WeatherTips({ city }) {
  const [weather, setWeather] = useState(null);
  const [tips, setTips] = useState([]);
  const API_KEY = import.meta.env.VITE_API_KEY || '5f31b1bc5d88a35c79c821c5ce03d82c';

  useEffect(() => {
    if (!city) return;

    axios
      .get(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`)
      .then((response) => {
        setWeather(response.data);
        const weatherMain = response.data.weather?.[0]?.main || '';
        const temp = response.data.main?.temp || 0; 
        let newTips = [];

        const getTemperatureTips = () => {
          if (temp >= 40) {
            return [
              { text: '‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏î‡∏î‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏°', icon: 'fa-sun' },
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏ö‡∏≤‡∏á‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ', icon: 'fa-tshirt' },
              { text: '‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏≤‡∏Å‡πÜ ‡πÅ‡∏•‡∏∞‡∏û‡∏Å‡∏£‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏ß‡∏Å', icon: 'fa-tint' },
            ];
          } else if (temp >= 35) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏Ç‡∏≤‡∏™‡∏±‡πâ‡∏ô ‡∏ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏£‡∏û‡∏Å‡∏£‡πà‡∏°‡πÅ‡∏•‡∏∞ ‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏•‡∏∏‡∏°', icon: 'fa-tshirt' },
              { text: '‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡∏ô‡πâ‡∏≥', icon: 'fa-tint' },
              { text: '‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏î‡∏î‡∏ô‡∏≤‡∏ô', icon: 'fa-sun' },
            ];
          } else if (temp >= 30) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏™‡∏ö‡∏≤‡∏¢‡πÜ', icon: 'fa-tshirt' },
              { text: '‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô', icon: 'fa-tint' },
            ];
          } else if (temp >= 25) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ç‡∏ô‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏Ç‡∏≤‡∏™‡∏±‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏¢‡∏≤‡∏ß', icon: 'fa-tshirt' },
              { text: '‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏™‡∏ö‡∏≤‡∏¢ ‡πÜ ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏ä‡∏≠‡∏ö', icon: 'fa-smile' },
            ];
          } else if (temp >= 20) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß‡∏ö‡∏≤‡∏á ‡πÜ ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏ï‡πÄ‡∏ö‡∏≤', icon: 'fa-tshirt' },
              { text: '‡∏û‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏•‡∏∏‡∏°‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡πá‡∏ô', icon: 'üß•' },
            ];
          } else if (temp >= 15) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏ï ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏Ç‡∏≤‡∏¢‡∏≤‡∏ß', icon: 'üß•' },
              { text: '‡πÉ‡∏™‡πà‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô', icon: 'fa-shoe-prints' },
            ];
          } else if (temp >= 10) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡∏Æ‡∏π‡πâ‡∏î ‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠', icon: 'üß£' },
              { text: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏™‡πà‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡πÑ‡∏î‡πâ', icon: 'fa-mitten' },
            ];
          } else if (temp >= 5) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡∏≤‡∏ß‡∏´‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡πâ‡∏ó ‡∏´‡∏°‡∏ß‡∏Å‡πÑ‡∏´‡∏°‡∏û‡∏£‡∏°', icon: 'üß•' },
              { text: '‡πÉ‡∏™‡πà‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ñ‡∏∏‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏≤', icon: 'fa-mitten' },
            ];
          } else if (temp >= 0) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô: ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Æ‡∏µ‡∏ó‡πÄ‡∏ó‡∏Ñ ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÑ‡∏´‡∏°‡∏û‡∏£‡∏° ‡πÇ‡∏Ñ‡πâ‡∏ó‡∏´‡∏ô‡∏≤', icon: 'üß•' },
              { text: '‡πÉ‡∏™‡πà‡∏´‡∏°‡∏ß‡∏Å ‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠ ‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏£‡∏ö', icon: 'üß£' },
            ];
          } else if (temp >= -20) {
            return [
              { text: '‡∏™‡∏ß‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡∏≤‡∏ß ‡∏ä‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô ‡πÇ‡∏Ñ‡πâ‡∏ó‡∏´‡∏ô‡∏≤', icon: 'üß•' },
              { text: '‡πÉ‡∏™‡πà‡∏ö‡∏π‡∏ó‡πÅ‡∏•‡∏∞‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ô‡∏•‡∏° ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏•‡∏∑‡πà‡∏ô', icon: 'fa-mitten' },
            ];
          } else {
            return [
              { text: '‡∏™‡∏ß‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡πâ‡∏ó‡∏´‡∏ô‡∏≤ ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡∏∑‡∏≠‡∏Å‡πÅ‡∏Ç‡πá‡∏á', icon: 'fa-snowflake' },
              { text: '‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏ú‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏°‡∏´‡∏ô‡∏≤‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏Å', icon: 'üß£' },
            ];
          }
        };

        newTips = getTemperatureTips();

        const getWeatherTips = () => {
          switch (weatherMain.toLowerCase()) {
            case 'rain':
            case 'drizzle':
              return [
                { text: '‡∏û‡∏Å‡∏£‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏ù‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô', icon: 'fa-umbrella' },
                { text: '‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ', icon: 'fa-shoe-prints' },
                { text: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ñ‡∏ô‡∏ô‡∏•‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ù‡∏ô‡∏ï‡∏Å', icon: 'fa-exclamation-triangle' },
              ];
            case 'clear':
              return [
                { text: '‡∏ó‡∏≤‡∏Ñ‡∏£‡∏µ‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏î‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏ú‡∏¥‡∏ß', icon: 'fa-sun' },
                { text: '‡∏™‡∏ß‡∏°‡πÅ‡∏ß‡πà‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏î‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á', icon: 'fa-glasses' },
              ];
            case 'clouds':
              return [
                { text: '‡∏û‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏à‡πá‡∏Ñ‡πÄ‡∏Å‡πá‡∏ï‡∏ö‡∏≤‡∏á ‡πÜ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô', icon: 'ü•º' },
                { text: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏ù‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô', icon: 'fa-cloud-rain' },
              ];
            case 'snow':
              return [
                { text: '‡∏™‡∏ß‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô', icon: 'fa-mitten' },
                { text: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏•‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏¥‡∏°‡∏∞', icon: 'fa-snowflake' },
                { text: '‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¥‡∏°‡∏∞‡∏ñ‡πâ‡∏≤‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ', icon: 'fa-car' },
              ];
            case 'thunderstorm':
              return [
                { text: '‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏≤‡∏¢‡∏∏', icon: 'fa-bolt' },
                { text: '‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô', icon: 'fa-plug' },
                { text: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏â‡∏≤‡∏¢‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏î‡∏±‡∏ö', icon: 'fa-flashlight' },
              ];
            case 'mist':
            case 'haze':
              return [
                { text: '‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ù‡∏∏‡πà‡∏ô', icon: 'fa-mask-face' },
                { text: '‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á', icon: 'fa-running' },
                { text: '‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ï‡∏±‡∏î‡∏´‡∏°‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ', icon: 'fa-lightbulb' },
              ];
            default:
              return [
                { text: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô', icon: 'fa-calendar' },
                { text: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', icon: 'fa-tshirt' },
              ];
          }
        };

        const weatherTips = getWeatherTips();
        const remainingSlots = 5 - newTips.length;
        if (remainingSlots > 0) {
          newTips = [...newTips, ...weatherTips.slice(0, remainingSlots)];
        }

     
        newTips = newTips.slice(0, 4);
        setTips(newTips);
      })
      .catch(() => {
        setWeather(null);
        setTips([{ text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ', icon: 'fa-times' }]);
      });
  }, [city]);

  return (
    <div className="weather-tips">
      <h2>Tips for {city || '‡πÄ‡∏°‡∏∑‡∏≠‡∏á'}</h2>
      {weather ? (
        <ul>
          {tips.map((tip, index) => (
            <li key={index} className="tip-item" aria-label={`‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${tip.text}`}>
              {tip.icon && tip.icon.startsWith('fa-') ? (
                <i className={`fas ${tip.icon} tip-icon`} aria-hidden="true"></i>
              ) : (
                <span className="tip-icon" role="img" aria-hidden="true">
                  {tip.icon || 'üåç'}
                </span>
              )}
              <span className="tip-text">{tip.text}</span>
            </li>
          ))}
        </ul>
      ) : (
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥...</p>
      )}
    </div>
  );
}

export default WeatherTips;
